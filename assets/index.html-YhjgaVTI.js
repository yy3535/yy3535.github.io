import{_ as d,r as i,o as v,c as m,b as n,e as a,w as t,d as s,a as e}from"./app-E-cEvfoH.js";const g={},b=n("h1",{id:"运行环境",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#运行环境","aria-hidden":"true"},"#"),s(" 运行环境")],-1),h={class:"table-of-contents"},f=e(`<h2 id="http协议" tabindex="-1"><a class="header-anchor" href="#http协议" aria-hidden="true">#</a> HTTP协议</h2><ul><li>HTTP协议的主要特点 <ul><li>简单快速(每个资源是固定的，处理起来简单，访问资源输入URI就行)</li><li>灵活（每个http协议头部分有个类型，可请求不同类型资源）</li><li>无连接【重要】（连接一次就会断掉，不会保持连接）</li><li>无状态【重要】（客户端和服务端是两种身份，单http协议上是不能区分两次连接的身份的）</li></ul></li><li>HTTP报文的组成部分 <ul><li>请求报文 <ul><li>请求行 <ul><li>请求方法</li><li>URL</li><li>http协议以及版本</li></ul></li><li>首部 <ul><li>key,value值告诉服务端我要哪些内容，哪些类型</li></ul></li><li>空行 <ul><li>请求头和请求体的分割</li></ul></li><li>主体 <ul><li>数据部分</li></ul></li></ul></li></ul></li></ul><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code><span class="token comment">&lt;!-- 请求行 --&gt;</span>
POST /search HTTP/1.1  
<span class="token comment">&lt;!-- 首部 --&gt;</span>
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/vnd.ms-powerpoint, 
application/msword, application/x-silverlight, application/x-shockwave-flash, <span class="token italic"><span class="token punctuation">*</span><span class="token content">/</span><span class="token punctuation">*</span></span>  
Referer: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.google.cn/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>http://www.google.cn/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>  
Accept-Language: zh-cn  
Accept-Encoding: gzip, deflate  
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; TheWorld)  
Host: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.google.cn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>www.google.cn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>  
Connection: Keep-Alive  
Cookie: PREF=ID=80a06da87be9ae3c:U=f7167333e2c3b714:NW=1:TM=1261551909:LM=1261551917:S=ybYcq2wpfefs4V9g; 
NID=31=ojj8d-IygaEtSxLgaJmqSjVhCspkviJrB6omjamNrSm8lZhKy_yMfO2M4QMRKcH1g0iQv9u-2hfBW7bUFwVh7pGaRUb0RnHcJU37y-
FxlRugatx63JLv7CWMD6UB_O_r  

hl=zh-CN&amp;source=hp&amp;q=domety
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>响应报文 <ul><li>状态行</li><li>首部</li><li>空行</li><li>主体</li></ul></li></ul><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code><span class="token comment">&lt;!-- 状态行 --&gt;</span>
HTTP/1.1 200 OK
<span class="token comment">&lt;!-- 响应头 --&gt;</span>
Date: Sat, 31 Dec 2005 23:59:59 GMT
Content-Type: text/html;charset=ISO-8859-1
Content-Length: 122

＜html＞
＜head＞
＜title＞Wrox Homepage＜/title＞
＜/head＞
＜body＞
＜!-- body goes here --＞
＜/body＞
＜/html＞
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),y=e("<p>HTTP方法</p><ul><li><p>get(获取资源)</p></li><li><p>post(传输资源)</p></li><li><p>put(更新资源)</p></li><li><p>delete(删除资源)</p></li><li><p>options(试探请求，跨域时会用到)</p></li><li><p>head(获得报文首部)</p></li><li><p>前四个叫做resful风格</p></li></ul>",2),w=n("ul",null,[n("li",null,"不同浏览器不一样，如果使用get请求，拼接的url不能太长，否则会被浏览器截断，http协议对长度有限制，所以太长发不出去，会截断")],-1),x=n("li",null,"GET产生的URL可以被收藏，而POST不可以(可不记)",-1),_=n("li",null,"GET请求只能进行url编码，而POST支持多种编码方式(可记可不记)",-1),q=n("li",null,"GET比POST更不安全，因为参数直接暴露在URL上，所以不能用来传递敏感信息(了解)",-1),T=n("li",null,[s("【总结】 "),n("ul",null,[n("li",null,"Get 请求能缓存，Post 不能"),n("li",null,"Post 相对 Get 安全一点点，因为Get 请求都包含在 URL 里（当然你想写到 body 里也是可以的），且会被浏览器保存历史纪录。Post 不会，但是在抓包的情况下都是一样的。"),n("li",null,"URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的"),n("li",null,"Post 支持更多的编码类型且不对数据类型限制")])],-1),S=e(`<li><p>HTTP状态码</p><table><thead><tr><th>状态</th><th>含义</th><th></th></tr></thead><tbody><tr><td>1XX</td><td>Informational(信息性状态码)</td><td></td></tr><tr><td>2XX</td><td>Success(成功状态码)</td><td></td></tr><tr><td>3XX</td><td>Redirection(重定向)</td><td></td></tr><tr><td>4XX</td><td>Client Error(客户端错误状态码)</td><td></td></tr><tr><td>5XX</td><td>Server Error(服务器错误状态吗)</td><td></td></tr></tbody></table><ul><li>2XX 成功 <ul><li>200 OK 客户端发过来的数据被正常处理</li><li>204 Not Content 正常响应，没有实体</li><li>206 Partial Content 范围请求，返回部分数据，响应报文中由Content-Range指定实体内容(较多，audio,video标签，文件很大时会返回这个)</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>curl <span class="token operator">-</span>v <span class="token operator">--</span>header <span class="token string">&quot;Range:bytes=0-3&quot;</span> <span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">www.baidu.com</span><span class="token regex-delimiter">/</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>3XX 重定向 <ul><li>301 Moved Permanently：永久重定向(换域名)</li><li>302 Found：临时重定向，规范要求方法名不变，但是都会改变</li><li>303(See Other) 和302类似，但必须用GET方法</li><li>304 Not Modified：配合(If-Match、If-Modified-Since、If-None_Match、If-Range、If-Unmodified-Since)。客户端有缓冲的文档并发出了一个条件性的请求，服务器告诉客户，原来的缓冲文档还可以继续使用</li><li>307(Temporary Redirect) 临时重定向，不该改变请求方法</li></ul></li><li>4XX 客户端错误 <ul><li>400 Bad Request：请求报文语法错误</li><li>401 Unauthorized：需要认证（没权限）</li><li>403 Forbidden：服务器拒绝访问对应的资源(较多，某页面的地址只能通过服务器来访问)</li><li>404 Not Found：服务器上无法找到资源</li></ul></li><li>5XX 服务器端错误 <ul><li>500 Internal Server Error：服务器故障</li><li>503 Server Unavailable：服务器处于超负载或正在停机维护</li></ul></li></ul></li>`,1),j=n("li",null,"管线化不会影响响应到来的顺序",-1),C=n("li",null,"http/1.1要求服务端支持管线化，但并不要求服务端对响应进行管线化处理，只要求对管线化的请求不失败即可",-1),E=n("li",null,"因为以上服务端问题，开启管线化可能并不会大幅度提升性能，而且很多服务器和代理程序对管线化支持并不好，因此Chrome和Firefox默认并未开启管线化支持",-1),P=e('<h3 id="udp和tcp" tabindex="-1"><a class="header-anchor" href="#udp和tcp" aria-hidden="true">#</a> UDP和TCP</h3><ul><li>UDP 1.面向无连接 2.有单播，多播，广播的功能 3.UDP 是面向报文的 4.不可靠性 5.头部开销小，传输数据报文时是很高效的。</li><li>TCP <ol><li>TCP 连接过程(三次握手)</li><li>TCP 断开链接（四次挥手）</li><li>特点</li></ol><ul><li>面向连接</li><li>仅支持单播传输</li><li>面向字节流</li><li>可靠传输</li><li>提供拥塞控制</li><li>TCP 提供全双工通信</li></ul></li><li>总结 <ul><li>TCP 向上层提供面向连接的可靠服务 ，UDP 向上层提供无连接不可靠服务。</li><li>虽然 UDP 并没有 TCP 传输来的准确，但是也能在很多实时性要求高的地方有所作为</li><li>对数据准确性要求高，速度可以相对较慢的，可以选用 TCP</li></ul></li></ul><h2 id="页面加载" tabindex="-1"><a class="header-anchor" href="#页面加载" aria-hidden="true">#</a> 页面加载</h2><h3 id="浏览器加载资源的过程" tabindex="-1"><a class="header-anchor" href="#浏览器加载资源的过程" aria-hidden="true">#</a> 浏览器加载资源的过程</h3>',4),L=n("h4",{id:"加载资源的形式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#加载资源的形式","aria-hidden":"true"},"#"),s(" 加载资源的形式")],-1),M=n("ul",null,[n("li",null,"输入 url 加载 html"),n("li",null,"http://coding.m.imooc.com"),n("li",null,"加载 html 中的静态资源"),n("li",null,[n("code",null,'<script src="/static/js/jquery.js"><\/script>')])],-1),D=n("h4",{id:"从输入url到得到html的过程",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#从输入url到得到html的过程","aria-hidden":"true"},"#"),s(" 从输入url到得到html的过程")],-1),O=n("ul",null,[n("li",null,"浏览器根据 DNS 服务器得到域名的 IP 地址"),n("li",null,"向这个 IP 的机器发送 http 请求"),n("li",null,"服务器收到、处理并返回 http 请求"),n("li",null,"浏览器得到返回内容")],-1),I=e('<h3 id="浏览器渲染页面的过程" tabindex="-1"><a class="header-anchor" href="#浏览器渲染页面的过程" aria-hidden="true">#</a> 浏览器渲染页面的过程</h3><ul><li>根据 HTML 结构生成 DOM Tree</li><li>根据 CSS 生成 CSS Rule</li><li>将 DOM 和 CSSOM 整合形成 RenderTree</li><li>根据 RenderTree 开始渲染和展示</li><li>遇到<code>&lt;script&gt;</code>时，会执行并阻塞渲染</li></ul><h3 id="为何要把-css-放在-head-中" tabindex="-1"><a class="header-anchor" href="#为何要把-css-放在-head-中" aria-hidden="true">#</a> 为何要把 css 放在 head 中</h3><h3 id="为何要把-js-放在-body-最后" tabindex="-1"><a class="header-anchor" href="#为何要把-js-放在-body-最后" aria-hidden="true">#</a> 为何要把 JS 放在 body 最后</h3>',4),R=e(`<h3 id="window-onload和domcontentloaded区别" tabindex="-1"><a class="header-anchor" href="#window-onload和domcontentloaded区别" aria-hidden="true">#</a> <code>window.onload</code>和<code>DOMContentLoaded</code>区别</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面的全部资源加载完才会执行，包括图片、视频等</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;DOMContentLoaded&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// DOM 渲染完即可执行，此时图片、视频还可能没有加载完</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),H=n("h2",{id:"性能优化",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#性能优化","aria-hidden":"true"},"#"),s(" 性能优化")],-1),X=n("ul",null,[n("li",null,[s("原则 "),n("ul",null,[n("li",null,"多使用内存、缓存或者其他方法"),n("li",null,"减少 CPU 计算、较少网络")])])],-1),N={id:"加载资源优化",tabindex:"-1"},U=n("a",{class:"header-anchor",href:"#加载资源优化","aria-hidden":"true"},"#",-1),B=e('<ul><li>静态资源的压缩合并（JS代码压缩合并、CSS代码压缩合并、雪碧图）</li><li>静态资源缓存（资源名称加 MD5 戳）</li><li>使用 CND 让资源加载更快</li><li>使用 SSR 后端渲染，数据直接突出到 HTML 中</li></ul><ol start="3"><li>合并请求：nginxMok ,sprite雪碧图</li><li>缓存 from cache(memory,disk) localstorage 本地缓存策略优化 HTTP头的缓存cache-control:max-age-60</li><li>tcp网络连接优化，tcp调优 http/2 keep-alive</li><li>硬件 加大带宽 使用cdn(对象存储)</li><li>资源大小：gzip,webp,image压缩，cookie体积减小</li><li>预加载：dns预解析,多个cdn域名,异步读取js(defer async)</li></ol>',2),F={id:"渲染优化",tabindex:"-1"},G=n("a",{class:"header-anchor",href:"#渲染优化","aria-hidden":"true"},"#",-1),W=e(`<ul><li>CSS 放前面 JS 放后面</li><li>尽早执行操作（<code>DOMContentLoaded</code>）</li><li>懒加载（图片懒加载、下拉加载更多）</li><li>减少DOM 查询，对 DOM 查询做缓存</li><li>减少DOM 操作，多个操作尽量合并在一起执行（<code>DocumentFragment</code>）</li><li>事件节流</li></ul><h3 id="详细解说" tabindex="-1"><a class="header-anchor" href="#详细解说" aria-hidden="true">#</a> 详细解说</h3><h4 id="静态资源的压缩合并" tabindex="-1"><a class="header-anchor" href="#静态资源的压缩合并" aria-hidden="true">#</a> 静态资源的压缩合并</h4><p>如果不合并，每个都会走一遍之前介绍的请求过程</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果压缩了，就只走一遍请求过程</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="静态资源缓存" tabindex="-1"><a class="header-anchor" href="#静态资源缓存" aria-hidden="true">#</a> 静态资源缓存</h4><p>通过连接名称控制缓存</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc_1.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>只有内容改变的时候，链接名称才会改变</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc_2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="使用-cnd-让资源加载更快" tabindex="-1"><a class="header-anchor" href="#使用-cnd-让资源加载更快" aria-hidden="true">#</a> 使用 CND 让资源加载更快</h4><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/zepto/1.0rc1/zepto.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="使用-ssr-后端渲染" tabindex="-1"><a class="header-anchor" href="#使用-ssr-后端渲染" aria-hidden="true">#</a> 使用 SSR 后端渲染</h4><p>如果提到 Vue 和 React 时，可以说一下</p><h4 id="css-放前面-js-放后面" tabindex="-1"><a class="header-anchor" href="#css-放前面-js-放后面" aria-hidden="true">#</a> CSS 放前面 JS 放后面</h4><p>将浏览器渲染的时候，已经提高</p><h4 id="懒加载" tabindex="-1"><a class="header-anchor" href="#懒加载" aria-hidden="true">#</a> 懒加载</h4><p>一开始先给为 src 赋值成一个通用的预览图，下拉时候再动态赋值成正式的图片</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preview.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-realsrc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="dom-查询做缓存" tabindex="-1"><a class="header-anchor" href="#dom-查询做缓存" aria-hidden="true">#</a> DOM 查询做缓存</h4><p>两端代码做一下对比</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> i
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> i
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结：DOM 操作，无论查询还是修改，都是非常耗费性能的，尽量减少</p><h4 id="合并-dom-插入" tabindex="-1"><a class="header-anchor" href="#合并-dom-插入" aria-hidden="true">#</a> 合并 DOM 插入</h4><p>DOM 操作是非常耗费性能的，因此插入多个标签时，先插入 Fragment 然后再统一插入DOM</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> listNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;list&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 要插入 10 个 li 标签</span>
<span class="token keyword">var</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x<span class="token punctuation">,</span> li<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;List item &quot;</span> <span class="token operator">+</span> x<span class="token punctuation">;</span>
    frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
listNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29),A=n("h4",{id:"防抖和节流",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#防抖和节流","aria-hidden":"true"},"#"),s(" 防抖和节流")],-1),J=n("li",null,"防抖和节流的作用都是防止函数多次调用。区别在于，假设一个用户一直触发这个函数，且每次触发函数的间隔小于wait，防抖的情况下只会调用一次，而节流的情况会每隔一定时间（参数wait）调用函数。",-1),z=n("li",null,"underscore的debounce方法 松手后隔会再执行",-1),V=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> timeoutId
textarea<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token comment">// 如果有连续动作，那取消执行。直到1s内没有第二次点击，才不会取消执行。</span>
    <span class="token punctuation">}</span>
    timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;内容修改了&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// debounce</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span>wait<span class="token punctuation">,</span>immediate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>immediate<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> callNow<span class="token operator">=</span><span class="token operator">!</span>timeout<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>callNow<span class="token punctuation">)</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    timeout<span class="token operator">=</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timeout<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>wait<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;logger&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 第三个参数表示首次点击有效果，之后就没效果了</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token function">debounce</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Q=n("li",null,"执行一次后，暂时失效，过了一段时间后再重新激活",-1),K=n("li",null,"underscore库中的throttle方法",-1),Y=e(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 事件功能有效</span>
textarea<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    valid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// 事件功能失效</span>
    timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;内容修改了&#39;</span><span class="token punctuation">)</span>
        valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 事件功能有效</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 节流</span>
<span class="token keyword">let</span> btn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;btn&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题：最后一次不能触发，但希望最后一次可以触发</span>
<span class="token comment">// function throttle(func,wait){</span>
<span class="token comment">//   let previous=0;</span>
<span class="token comment">//   return function (){</span>
<span class="token comment">//     let now=Date.now();</span>
<span class="token comment">//     if(now-previous&gt;wait){</span>
<span class="token comment">//       func.apply(this,arguments);</span>
<span class="token comment">//       previous=now;</span>
<span class="token comment">//     }</span>
<span class="token comment">//   }</span>
<span class="token comment">// }</span>

<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span>wait<span class="token punctuation">,</span>options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// trailing最后一次应该触发（默认触发）</span>
  <span class="token keyword">let</span> args<span class="token punctuation">,</span>context<span class="token punctuation">,</span>previous<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>timeout<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">later</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    previous<span class="token operator">=</span>options<span class="token punctuation">.</span>leading<span class="token operator">===</span><span class="token boolean">false</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    args<span class="token operator">=</span>context<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">throttled</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    args<span class="token operator">=</span>arguments<span class="token punctuation">;</span>
    context<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> now<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>previous<span class="token operator">&amp;&amp;</span>options<span class="token punctuation">.</span>leading<span class="token operator">===</span><span class="token boolean">false</span><span class="token punctuation">)</span> previous<span class="token operator">=</span>now<span class="token punctuation">;</span>
    <span class="token keyword">let</span> remaning<span class="token operator">=</span>wait<span class="token operator">-</span><span class="token punctuation">(</span>now<span class="token operator">-</span>previous<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>remaining<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 第一次</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeout<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      previous<span class="token operator">=</span>now<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timeout <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>trailing<span class="token operator">!==</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      timeout<span class="token operator">=</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span>remaning<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> throttled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;logger&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token function">throttle</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">trailing</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>loadash库中，将两个合起来成为一个</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./debounce.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./throttle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;logger&#39;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 第三个参数 表示首次 先触发一下</span>
    btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// debounce.js</span>
<span class="token comment">// 防抖 + 节流</span>
<span class="token comment">// debounce 就是上来后 先开一个定时 只要一直点击  到时间什么都不做 就在开一个定时器</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> maxWait<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;maxWait&#39;</span> <span class="token keyword">in</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    maxWait <span class="token operator">=</span> opts<span class="token punctuation">.</span>maxWait<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> leading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 第一次点击时触发</span>
  <span class="token keyword">let</span> trailing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 最后一次也要触发</span>
  <span class="token comment">// loadash 定时器实现的</span>
  <span class="token keyword">let</span> lastCallTime<span class="token punctuation">;</span> <span class="token comment">// 最后调用的时间 previous</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword">let</span> lastThis<span class="token punctuation">;</span> <span class="token comment">// 返回函数的this</span>
  <span class="token keyword">let</span> lastArgs<span class="token punctuation">;</span> <span class="token comment">// 返回函数的参数</span>
  <span class="token comment">// shouldInvoke 是否应该调用</span>
  <span class="token keyword">let</span> lastInvokeTime<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">shouldInvoke</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">now</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sinceLastTime <span class="token operator">=</span> now <span class="token operator">-</span> lastCallTime<span class="token punctuation">;</span>
    <span class="token keyword">let</span> sinceLastInvoke <span class="token operator">=</span> now <span class="token operator">-</span> lastInvokeTime<span class="token punctuation">;</span>
    <span class="token comment">// 第一次</span>
    <span class="token keyword">return</span> lastCallTime <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> sinceLastTime <span class="token operator">&gt;</span> wait <span class="token operator">||</span> sinceLastInvoke <span class="token operator">&gt;=</span> maxWait<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// leadingEdge 是否第一次执行</span>
  <span class="token keyword">let</span> <span class="token function-variable function">invokeFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastInvokeTime <span class="token operator">=</span> time<span class="token punctuation">;</span> <span class="token comment">// 最终的调用函数的时间</span>
    <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lastThis<span class="token punctuation">,</span> lastArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// startTimer就是开启了一个定时器</span>
  <span class="token keyword">let</span> <span class="token function-variable function">startTimer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">timerExpired<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>timerExpired<span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">remainingWait</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">now</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> lastCallTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">trailingEdge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    timeout <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>trailing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">invokeFunc</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">timerExpired</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前定时器到时间了 看看是否需要执行这个函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldInvoke</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果需要调用</span>
      <span class="token comment">// 触发结束的方法</span>
      <span class="token keyword">return</span> <span class="token function">trailingEdge</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">startTimer</span><span class="token punctuation">(</span>timerExpired<span class="token punctuation">,</span> <span class="token function">remainingWait</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">leadingEdge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastInvokeTime <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 需要执行就调用函数</span>
      <span class="token function">invokeFunc</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">startTimer</span><span class="token punctuation">(</span>timerExpired<span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开启一个定时器 看下一次定时器到了 是否需要执行func</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token function-variable function">debounced</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastThis <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    lastArgs <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断当前的debounce时是否需要执行</span>
    <span class="token keyword">let</span> isInvoking <span class="token operator">=</span> <span class="token function">shouldInvoke</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    lastCallTime <span class="token operator">=</span> now<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isInvoking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">leadingEdge</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> debounced<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// throttle.js</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span>wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">debounce</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token comment">// maxWait最大的点击时间</span>
    <span class="token literal-property property">maxWait</span><span class="token operator">:</span>wait
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>20000000px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">scroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loggeer<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">loggeer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;logger&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;scroll&#39;</span><span class="token punctuation">,</span>scroll<span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),Z=e(`<ul><li>应用 <ul><li>搜索框input事件，例如要支持输入实时搜索可以使用节流方案（间隔一段时间就必须查询相关内容），或者实现输入间隔大于某个值（如500ms），就当做用户输入完成，然后开始搜索，具体使用哪种方案要看业务需求。</li><li>页面resize事件，常见于需要做页面适配的时候。需要根据最终呈现的页面情况进行dom渲染（这种情形一般是使用防抖，因为只需要判断最后一次的变化情况）</li></ul></li></ul><h4 id="尽早执行操作" tabindex="-1"><a class="header-anchor" href="#尽早执行操作" aria-hidden="true">#</a> 尽早执行操作</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面的全部资源加载完才会执行，包括图片、视频等</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;DOMContentLoaded&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// DOM 渲染完即可执行，此时图片、视频还可能没有加载完</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安全性" tabindex="-1"><a class="header-anchor" href="#安全性" aria-hidden="true">#</a> 安全性</h2><h3 id="推荐书" tabindex="-1"><a class="header-anchor" href="#推荐书" aria-hidden="true">#</a> 推荐书</h3><ul><li>阅读《白帽子讲web安全》</li></ul><h3 id="web-攻击方式" tabindex="-1"><a class="header-anchor" href="#web-攻击方式" aria-hidden="true">#</a> web 攻击方式</h3>`,7),$=n("li",null,[n("p",null,"SQL注入"),n("ul",null,[n("li",null,"例如做一个系统的登录界面，输入用户名和密码，提交之后，后端直接拿到数据就拼接 SQL 语句去查询数据库。如果在输入时进行了恶意的 SQL 拼装，那么最后生成的 SQL 就会有问题。但是现在稍微大型的一点系统，都不会这么做，从提交登录信息到最后拿到授权，都经过层层的验证。因此，SQL 注入都只出现在比较低端小型的系统上。")])],-1),nn=e(`<p>XSS</p><ul><li>基本概念和缩写 <ul><li>Cross Site Scripting，【记】跨站脚本攻击</li></ul></li><li>攻击原理 <ul><li>与CSRF区别，不需要任何验证，通过合法方式向页面注入js，比如评论</li></ul></li><li>攻击类型 <ul><li>反射型 <ul><li>查询的参数里有代码</li><li>查询参数用encodeURIComponent编译即可。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 关闭浏览器的XSS拦截</span>
  res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;X-XSS-Protection&#39;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;Express&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">xss</span><span class="token operator">:</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>xss <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// index.ejs</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> xss <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 篡改页面内容，自动触发</span>
<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/?xss=&lt;img src=&quot;null&quot; onerror=&quot;alert(1)&quot;/&gt;</span><span class="token template-punctuation string">\`</span></span>
<span class="token comment">// 篡改页面内容，引诱触发</span>
<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/?xss=&lt;p onclick=&quot;alert(&#39;点我&#39;)&quot;&gt;点我&lt;/p&gt;</span><span class="token template-punctuation string">\`</span></span>
<span class="token comment">// 篡改页面内容，最简单的广告插入</span>
<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:3000/?xss=&lt;iframe src=&quot;//baidu.com/t.html&quot;&gt;&lt;/iframe&gt;</span><span class="token template-punctuation string">\`</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>DOM-Based <ul><li>基于后端</li></ul></li><li>存储型 <ul><li>恶意脚本存储到了服务器上，所有人访问都会有问题，比反射性和DOM-Baseed范围更大</li></ul></li></ul></li><li>攻击方式 <ul><li>盗用cookie，获取敏感信息</li><li>破坏页面结构，插入一些内容</li><li>利用flash，了解即可</li><li>DDOS(分布式拒绝服务攻击)，是目前最为强大最难以防御的攻击方式之一。 <ul><li>DOS攻击：利用合理的客户端请求来占用过多的服务器资源，从而使合法用户无法得到服务器的响应</li><li>DDOS是在传统的DOS攻击上产生的一类攻击方式</li></ul></li><li>ServerlimitDOS(当http header过长的时候，web server会产生一个400或者是4开头的错误，如果这些超长的数据保存在cookie中，能够让用户每次访问的时候造成http头超长，导致一些用户无法访问域名)</li></ul></li></ul>`,2),sn=e(`<p>防御</p><ul><li>客户端传递给服务器时，需要先校验过滤一下</li><li>服务端再做一次过滤</li><li>直接在输出的时候过滤</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">html_encode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> s<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;nbsp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\&#39;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;s&#39;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
  <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),an=n("ul",null,[n("li",null,"对用户输入的数据进行HTML Entity转义，显示为转义字符")],-1),tn=n("br",null,null,-1),pn=n("br",null,null,-1),en=e("<table><thead><tr><th>转义字符</th><th>意义</th><th>ASCII码值（十进制）</th></tr></thead><tbody><tr><td>\\a</td><td>响铃(BEL)</td><td>007</td></tr><tr><td>\\b</td><td>退格(BS) ，将当前位置移到前一列</td><td>008</td></tr><tr><td>\\f</td><td>换页(FF)，将当前位置移到下页开头</td><td>012</td></tr><tr><td>\\n</td><td>换行(LF) ，将当前位置移到下一行开头</td><td>010</td></tr><tr><td>\\r</td><td>回车(CR) ，将当前位置移到本行开头</td><td>013</td></tr><tr><td>\\t</td><td>水平制表(HT) （跳到下一个TAB位置）</td><td>009</td></tr><tr><td>\\v</td><td>垂直制表(VT)</td><td>011</td></tr><tr><td>\\</td><td>代表一个反斜线字符&#39;&#39;&#39;</td><td>092</td></tr><tr><td>&#39;</td><td>代表一个单引号（撇号）字符</td><td>039</td></tr><tr><td>&quot;</td><td>代表一个双引号字符</td><td>034</td></tr><tr><td>?</td><td>代表一个问号</td><td>063</td></tr><tr><td>\\0</td><td>空字符(NUL)</td><td>000</td></tr><tr><td>\\ddd</td><td>1到3位八进制数所代表的任意字符</td><td>三位八进制</td></tr><tr><td>\\xhh</td><td>十六进制所代表的任意字符</td><td>十六进制</td></tr></tbody></table>",1),on={class:"custom-container tip"},ln=n("p",{class:"custom-container-title"},"HTML Entity",-1),cn=n("p",null,"一个HTML 实体 是一段文本（“串”），以与符号（开始&）和结束用分号（;）。实体通常用于显示保留字符（否则将被解释为HTML代码）和不可见字符（例如不间断空格）。",-1),un=n("pre",null,[n("code",null,`|字符|实体|HTML实体名称|注意|
|:---:|:---:|:---:|
|     "      | \\&quot; |解释为属性值的开始和结束。|
|     &      | \\&amp;  |解释为实体或字符引用的开始。|
|     <      |  \\&lt;  |解释为标签的开头|
|     >      |  \\&gt;  |解释为标签的结尾|
| 不断开空格   | \\&nbsp; ||
`)],-1),rn={href:"https://html.spec.whatwg.org/multipage/named-characters.html#named-character-references",target:"_blank",rel:"noopener noreferrer"},kn=n("ul",null,[n("li",null,"移除用户上传的DOM属性，如onerror等"),n("li",null,"移除用户上传的Style节点、Script节点、Iframe节点等。")],-1),dn={start:"2"},vn=n("ul",null,[n("li",null,"避免直接对HTML Entity解码"),n("li",null,"使用DOM Parse转换，矫正不配对的DOM标签")],-1),mn=n("li",null,[n("p",null,"实战")],-1),gn=n("li",null,[n("p",null,"插件库"),n("ul",null,[n("li",null,"encode.js：可以使用https://github.com/mathiasbynens/he 中的he.js"),n("li",null,"domParse：可以用https://github.com/blowsie/Pure-JavaScript-HTML5-Parser 中的htmlparser.js")])],-1),bn=e(`<div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>// 通过构建Node服务和简历一个评论功能，实例演示XSS的攻击及预防
// index.ejs
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>stylesheet<span class="token punctuation">&#39;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/stylesheets/style.css<span class="token punctuation">&#39;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/javascripts/encode.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/javascripts/domParse.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> <span class="token function-variable function">parse</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> results<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
          <span class="token comment">// 先反转义（解码），再domparse</span>
          <span class="token function">HTMLParser</span><span class="token punctuation">(</span>he<span class="token punctuation">.</span><span class="token function">unescape</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">strict</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token function-variable function">start</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span>attrs<span class="token punctuation">,</span>unary</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">// 开始标签</span>
              <span class="token comment">// 【防xss】2. 过滤危险标签</span>
              <span class="token comment">// style标签可控制元素是否显示</span>
              <span class="token comment">// iframe通常用来插入广告（是跨域的）</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>tag<span class="token operator">==</span><span class="token string">&#39;script&#39;</span><span class="token operator">||</span>tag<span class="token operator">==</span><span class="token string">&#39;style&#39;</span><span class="token operator">||</span>tag<span class="token operator">==</span><span class="token string">&#39;link&#39;</span><span class="token operator">||</span>tag<span class="token operator">==</span><span class="token string">&#39;iframe&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
              results<span class="token operator">+=</span><span class="token string">&#39;&lt;&#39;</span><span class="token operator">+</span>tag<span class="token punctuation">;</span>
              <span class="token comment">// 【防xss】3. 所有属性都不添加，即去掉了onclick onerror等等</span>
              <span class="token comment">// for(var i=0,len=attrs.length;i&lt;len;i++){</span>
              <span class="token comment">//   results+=&quot; &quot;+attrs[i].name+&#39;=&quot;&#39;+attrs[i].escaped+&#39;&quot;&#39;;</span>
              <span class="token comment">// }</span>
              results<span class="token operator">+=</span><span class="token punctuation">(</span>unary<span class="token operator">?</span><span class="token string">&quot;/&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">end</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tag</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">// 结束标签</span>
              results<span class="token operator">+=</span><span class="token string">&quot;&lt;/&quot;</span><span class="token operator">+</span>tag<span class="token operator">+</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">chars</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">// 标签中间部分</span>
              results<span class="token operator">+=</span>text<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">comment</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">// 注释部分</span>
              results<span class="token operator">+=</span><span class="token string">&quot;&lt;!--&quot;</span><span class="token operator">+</span>text<span class="token operator">+</span><span class="token string">&quot;--&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> results
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>&lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Welcome to &lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>sks <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/1.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> btn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> get<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> txt<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;txt&quot;</span><span class="token punctuation">)</span>
      btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> url<span class="token operator">=</span><span class="token string">&#39;/comment?comment=&#39;</span><span class="token operator">+</span>txt<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">===</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      get<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> url<span class="token operator">=</span><span class="token string">&#39;/getComment&#39;</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">===</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">var</span> com<span class="token operator">=</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// var com=JSON.parse(xhr.response).comment;</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>com<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">var</span> txt<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;span&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              txt<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span>com<span class="token punctuation">;</span>
              document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> comments<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 【防xss】1.字符转义，前端或者后端做都可以</span>
<span class="token keyword">function</span> <span class="token function">html_encode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> s<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;nbsp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\&#39;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;s&#39;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
  <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* GET home page. */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;Express&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/comment&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  comments<span class="token punctuation">.</span>v<span class="token operator">=</span><span class="token function">html_encode</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// comments.v=req.query.comment;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;插入的&#39;</span><span class="token punctuation">,</span>comments<span class="token punctuation">.</span>v<span class="token punctuation">)</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/getComment&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comments<span class="token punctuation">.</span>v<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">comment</span><span class="token operator">:</span>comments<span class="token punctuation">.</span>v
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CSP</li><li></li></ul><p>CSP 本质上就是建立白名单，开发者明确告诉浏览器哪些外部资源可以加载和执行。我们只需要配置规则，如何拦截是由浏览器自己实现的。我们可以通过这种方式来尽量减少 XSS 攻击。</p><p>通常可以通过两种方式来开启 CSP：</p><ul><li>设置 HTTP Header 中的 Content-Security-Policy</li><li>设置 meta 标签的方式 <meta http-equiv="Content-Security-Policy"></li></ul><p>这里以设置 HTTP Header 来举例</p><p>只允许加载本站资源</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Content-Security-Policy</span><span class="token punctuation">:</span> <span class="token header-value csp languages-csp">default-src ‘self’</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>只允许加载 HTTPS 协议图片</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Content-Security-Policy</span><span class="token punctuation">:</span> <span class="token header-value csp languages-csp">img-src https://*</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>允许加载任何来源框架</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Content-Security-Policy</span><span class="token punctuation">:</span> <span class="token header-value csp languages-csp">child-src &#39;none&#39;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当然可以设置的属性远不止这些，你可以通过查阅 文档 的方式来学习，这里就不过多赘述其他的属性了。</p><p>对于这种方式来说，只要开发者配置了正确的规则，那么即使网站存在漏洞，攻击者也不能执行它的攻击代码，并且 CSP 的兼容性也不错。</p>`,15),hn=n("p",null,"CSRF",-1),fn=n("li",null,[s("基本概念和缩写 "),n("ul",null,[n("li",null,"Cross-site request forgery，【记】跨站请求伪造")])],-1),yn=["src"],wn=n("li",null,[s("防御措施 "),n("ul",null,[n("li",null,"Token验证(链接自动携带cookie，但是不会自动携带token)"),n("li",null,"Referer验证(页面来源，判断来源是否是本站点下的页面)"),n("li",null,"隐藏令牌(隐藏在http header头中)")])],-1),xn=n("li",null,[n("p",null,"XSS和CSRF区别"),n("ul",null,[n("li",null,"XSS是上传输入的js脚本，并执行"),n("li",null,"CSRF是需要用户已登录，帮你自动执行接口")])],-1);function _n(u,qn){const p=i("router-link"),o=i("highlight-box"),c=i("mark-check"),l=i("underline-box"),r=i("absolute-box"),k=i("ExternalLinkIcon");return v(),m("div",null,[b,n("nav",h,[n("ul",null,[n("li",null,[a(p,{to:"#http协议"},{default:t(()=>[s("HTTP协议")]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#udp和tcp"},{default:t(()=>[s("UDP和TCP")]),_:1})])])]),n("li",null,[a(p,{to:"#页面加载"},{default:t(()=>[s("页面加载")]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#浏览器加载资源的过程"},{default:t(()=>[s("浏览器加载资源的过程")]),_:1})]),n("li",null,[a(p,{to:"#浏览器渲染页面的过程"},{default:t(()=>[s("浏览器渲染页面的过程")]),_:1})]),n("li",null,[a(p,{to:"#为何要把-css-放在-head-中"},{default:t(()=>[s("为何要把 css 放在 head 中")]),_:1})]),n("li",null,[a(p,{to:"#为何要把-js-放在-body-最后"},{default:t(()=>[s("为何要把 JS 放在 body 最后")]),_:1})]),n("li",null,[a(p,{to:"#window-onload和domcontentloaded区别"},{default:t(()=>[s("window.onload和DOMContentLoaded区别")]),_:1})])])]),n("li",null,[a(p,{to:"#性能优化"},{default:t(()=>[s("性能优化")]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#加载资源优化"},{default:t(()=>[a(o,null,{default:t(()=>[s("加载资源优化")]),_:1})]),_:1})]),n("li",null,[a(p,{to:"#渲染优化"},{default:t(()=>[a(o,null,{default:t(()=>[s("渲染优化")]),_:1})]),_:1})]),n("li",null,[a(p,{to:"#详细解说"},{default:t(()=>[s("详细解说")]),_:1})])])]),n("li",null,[a(p,{to:"#安全性"},{default:t(()=>[s("安全性")]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#推荐书"},{default:t(()=>[s("推荐书")]),_:1})]),n("li",null,[a(p,{to:"#web-攻击方式"},{default:t(()=>[s("web 攻击方式")]),_:1})])])])])]),f,n("ul",null,[n("li",null,[y,a(c,{id:"post&get"})]),n("li",null,[a(o,null,{default:t(()=>[s("POST和GET的区别")]),_:1}),n("ul",null,[n("li",null,[a(l,null,{default:t(()=>[s("GET在浏览器回退时是无害的，而POST会再次提交请求")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("GET请求会被浏览器主动缓存，而POST不可以")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("GET请求参数会被完整保留在浏览器历史纪录里，而POST中的参数不会被保留")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("GET请求在URL中传送的参数是有长度限制的，而POST没有限制")]),_:1}),w]),n("li",null,[a(l,null,{default:t(()=>[s("对参数的数据类型，GET只接受ASCII字符，而POST没有限制")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("GET参数通过URL传递，POST放在Request body中（了解）")]),_:1})]),x,_,q,T])]),S,n("li",null,[a(o,null,{default:t(()=>[s("什么是持久连接")]),_:1}),n("ul",null,[n("li",null,[s("http普通模式是无连接无状态，但是"),a(l,null,{default:t(()=>[s("可设置keep-alive模式支持持久链接")]),_:1}),s("，当出现对服务器的后继请求事，避免了建立或者重新建立连接。从http1.1版本开始才支持。")])])]),n("li",null,[a(o,null,{default:t(()=>[s("什么是管线化")]),_:1}),n("ul",null,[n("li",null,[a(l,null,{default:t(()=>[s("普通持久连接")]),_:1}),n("ul",null,[n("li",null,[a(l,null,{default:t(()=>[s("请求1->响应1->请求2->响应2->请求3->响应3")]),_:1})])])]),n("li",null,[a(l,null,{default:t(()=>[s("管线化持久连接")]),_:1}),n("ul",null,[n("li",null,[a(l,null,{default:t(()=>[s("请求1->请求2->请求3->响应1->响应2->响应3(请求打包过去，响应打包发回来)")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("管线化机制通过持久连接完成，http1.1才支持")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("只有GET和HEAD请求可以管线化，而POST有所限制")]),_:1})]),n("li",null,[a(l,null,{default:t(()=>[s("初次创建连接不应启动管线机制，因为对方服务器不一定支持http/1.1版本的协议")]),_:1})]),j,C,E])])])])]),P,a(c,{id:"jiazaiziyuan"}),L,M,a(c,{id:"url2html"}),D,O,a(c,{id:"yemianxuanran"}),I,a(c,{id:"onloadDomContentLoaded"}),R,a(c,{id:"xingnengyouhua"}),H,X,n("h3",N,[U,s(),a(o,null,{default:t(()=>[s("加载资源优化")]),_:1})]),B,n("h3",F,[G,s(),a(o,null,{default:t(()=>[s("渲染优化")]),_:1})]),W,a(c,{id:"fangdoujieliu"}),A,n("ul",null,[J,n("li",null,[a(o,null,{default:t(()=>[s("防抖(debounce)")]),_:1}),n("ul",null,[n("li",null,[a(o,null,{default:t(()=>[s("让某个时间期限（如上面的1000毫秒）内，事件处理函数只执行最后一次")]),_:1})]),z])])]),V,n("ul",null,[n("li",null,[a(o,null,{default:t(()=>[s("节流(Throttle)")]),_:1}),n("ul",null,[n("li",null,[a(o,null,{default:t(()=>[s("一段时间内，代码只执行一次。")]),_:1})]),Q,K])])]),Y,a(c,{id:"fangdoujieliuyingyong"}),Z,n("ul",null,[$,n("li",null,[nn,a(c,{id:"xssfangyu"}),n("ul",null,[n("li",null,[sn,n("ol",null,[n("li",null,[a(o,null,{default:t(()=>[s("转义")]),_:1})])]),an,a(r,null,{default:t(()=>[s("两种转义字符的方式："),tn,s("1. 反斜杠加在特定的字符之前表示转义。"),pn,s("2. 使用HTML Entity转义字符串")]),_:1}),en,n("div",on,[ln,cn,un,n("p",null,[n("a",rn,[s("HTML保留字符列表"),a(k)])])]),n("ol",null,[n("li",null,[a(o,null,{default:t(()=>[s("过滤")]),_:1})])]),kn,n("ol",dn,[n("li",null,[a(o,null,{default:t(()=>[s("校正")]),_:1})])]),vn]),mn,gn])])]),bn,n("ul",null,[n("li",null,[hn,n("ul",null,[fn,n("li",null,[s("攻击原理 "),n("ul",null,[n("li",null,[n("img",{src:u.$withBase("/img/攻击原理.jpg")},null,8,yn)])])]),wn])]),xn])])}const Sn=d(g,[["render",_n],["__file","index.html.vue"]]);export{Sn as default};
